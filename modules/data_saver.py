import os  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
import re  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏
import pandas as pd  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É pandas –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
from datetime import datetime  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
from .json_manager import JsonTermManager  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞–º–∏ –≤ JSON

class DataSaver:  # –ö–ª–∞—Å—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    def __init__(self):  # –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–ª–∞—Å—Å–∞
        self.directories = {  # –°–ª–æ–≤–∞—Ä—å —Å –ø—É—Ç—è–º–∏ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            'csv': 'results/csv',  # –ü—É—Ç—å –¥–ª—è CSV —Ñ–∞–π–ª–æ–≤
            'excel': 'results/excel'  # –ü—É—Ç—å –¥–ª—è Excel —Ñ–∞–π–ª–æ–≤
        }
        self._create_directories()  # –°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        self.json_manager = JsonTermManager()  # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ JSON

    def _create_directories(self):  # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
        """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π"""
        for directory in self.directories.values():  # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—É—Ç–∏ –∏–∑ —Å–ª–æ–≤–∞—Ä—è
            if not os.path.exists(directory):  # –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                os.makedirs(directory)  # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

    def parse_ai_terms(self, ai_response):  # –ú–µ—Ç–æ–¥ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –ò–ò
        """–ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –ò–ò –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö"""
        terms_data = []  # –°–ø–∏—Å–æ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ—Ä–º–∏–Ω–∞—Ö
        current_term = {}  # –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞
        
        # –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –∏ —É–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ
        lines = [line.strip() for line in ai_response.split('\n') if line.strip()]  # –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –∏ —É–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ
        
        # –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞
        number_pattern = r'^\d+\.'  # –®–∞–±–ª–æ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–æ–º–µ—Ä–∞ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏
        
        for line in lines:  # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏
            # –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
            line = line.strip()  # –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –Ω–∞—á–∞–ª–∞ —Ç–µ—Ä–º–∏–Ω–∞
            is_numbered_term = bool(re.match(number_pattern, line) and ('–¢–µ—Ä–º–∏–Ω:' in line or '**–¢–µ—Ä–º–∏–Ω:**' in line))  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–µ—Ä–º–∏–Ω–æ–º
            is_simple_term = line.startswith(('–¢–µ—Ä–º–∏–Ω:', '**–¢–µ—Ä–º–∏–Ω:**', '### –¢–µ—Ä–º–∏–Ω:'))  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø—Ä–æ—Å—Ç—ã–º —Ç–µ—Ä–º–∏–Ω–æ–º
            
            if is_numbered_term or is_simple_term:  # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—á–∞–ª–æ–º –Ω–æ–≤–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞
                # –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–µ—Ä–º–∏–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ
                if current_term:  # –ï—Å–ª–∏ —Å–ª–æ–≤–∞—Ä—å —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç
                    terms_data.append(current_term)  # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ç–µ—Ä–º–∏–Ω –≤ —Å–ø–∏—Å–æ–∫
                
                # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω
                current_term = {}  # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞
                
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞
                if '**–¢–µ—Ä–º–∏–Ω:**' in line:  # –ï—Å–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å –º–∞—Ä–∫–µ—Ä "**–¢–µ—Ä–º–∏–Ω:**"
                    term = line.split('**–¢–µ—Ä–º–∏–Ω:**')[1].strip()  # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞
                elif '–¢–µ—Ä–º–∏–Ω:' in line:  # –ï—Å–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å –º–∞—Ä–∫–µ—Ä "–¢–µ—Ä–º–∏–Ω:"
                    term = line.split('–¢–µ—Ä–º–∏–Ω:')[1].strip()  # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞
                
                # –£–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä –∏ —Ä–µ—à–µ—Ç–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                if is_numbered_term:  # –ï—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π
                    term = re.sub(number_pattern, '', term).strip()  # –£–¥–∞–ª—è–µ–º –Ω–æ–º–µ—Ä
                term = term.replace('#', '').strip()  # –£–¥–∞–ª—è–µ–º —Å–∏–º–≤–æ–ª—ã —Ä–µ—à–µ—Ç–∫–∏ –∏ –ø—Ä–æ–±–µ–ª—ã
                    
                current_term['—Ç–µ—Ä–º–∏–Ω'] = term  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞ –≤ —Å–ª–æ–≤–∞—Ä—å
                
            elif any(marker in line for marker in ['**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**', '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:', '- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**']):  # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                definition = line  # –ö–æ–ø–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É
                for marker in ['**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**', '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:', '- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**', '-']:  # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
                    definition = definition.replace(marker, '')  # –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
                current_term['–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ'] = definition.strip()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ —Å–ª–æ–≤–∞—Ä—å
                
            elif any(marker in line for marker in ['**–ü–µ—Ä–µ–≤–æ–¥:**', '–ü–µ—Ä–µ–≤–æ–¥:', '- **–ü–µ—Ä–µ–≤–æ–¥:**']):  # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ–≤–æ–¥
                translation = line  # –ö–æ–ø–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É
                for marker in ['**–ü–µ—Ä–µ–≤–æ–¥:**', '–ü–µ—Ä–µ–≤–æ–¥:', '- **–ü–µ—Ä–µ–≤–æ–¥:**', '-']:  # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
                    translation = translation.replace(marker, '')  # –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
                current_term['–ø–µ—Ä–µ–≤–æ–¥'] = translation.strip()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥ –≤ —Å–ª–æ–≤–∞—Ä—å
                
            elif any(marker in line for marker in ['**–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å:**', '–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å:', '- **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å:**']):  # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
                relevance = line  # –ö–æ–ø–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É
                for marker in ['**–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å:**', '–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å:', '- **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å:**', '-']:  # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
                    relevance = relevance.replace(marker, '')  # –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
                relevance = relevance.replace('%', '').strip()  # –£–¥–∞–ª—è–µ–º —Å–∏–º–≤–æ–ª –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –∏ –ø—Ä–æ–±–µ–ª—ã
                try:
                    current_term['—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å'] = float(relevance)  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–ª–æ–≤–∞—Ä—å
                except ValueError:  # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ
                    current_term['—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å'] = 0.0  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å 0
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Ä–º–∏–Ω
        if current_term:  # –ï—Å–ª–∏ —Å–ª–æ–≤–∞—Ä—å —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç
            terms_data.append(current_term)  # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Ä–º–∏–Ω –≤ —Å–ø–∏—Å–æ–∫
            
        return terms_data  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ç–µ—Ä–º–∏–Ω–∞—Ö

    def save_to_csv(self, terms_data, base_filename):  # –ú–µ—Ç–æ–¥ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ CSV
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ CSV —Ñ–æ—Ä–º–∞—Ç"""
        if not terms_data:  # –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            return False  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º False
            
        csv_path = os.path.join(self.directories['csv'], f"{base_filename}.csv")  # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ CSV —Ñ–∞–π–ª—É
        df = pd.DataFrame(terms_data)  # –°–æ–∑–¥–∞–µ–º DataFrame –∏–∑ –¥–∞–Ω–Ω—ã—Ö
        df.to_csv(csv_path, index=False, encoding='utf-8')  # –°–æ—Ö—Ä–∞–Ω—è–µ–º DataFrame –≤ CSV
        print(f"–¢–µ—Ä–º–∏–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ CSV: {csv_path}")  # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
        return True  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º True

    def save_to_excel(self, terms_data, base_filename):  # –ú–µ—Ç–æ–¥ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Excel
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Excel —Ñ–æ—Ä–º–∞—Ç"""
        if not terms_data:  # –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            return False  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º False
            
        excel_path = os.path.join(self.directories['excel'], f"{base_filename}.xlsx")  # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ Excel —Ñ–∞–π–ª—É
        df = pd.DataFrame(terms_data)  # –°–æ–∑–¥–∞–µ–º DataFrame –∏–∑ –¥–∞–Ω–Ω—ã—Ö
        df.to_excel(excel_path, index=False)  # –°–æ—Ö—Ä–∞–Ω—è–µ–º DataFrame –≤ Excel
        print(f"–¢–µ—Ä–º–∏–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Excel: {excel_path}")  # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
        return True  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º True

    def prepare_terms_for_json(self, terms_data):  # –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è JSON
      """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ JSON"""
      try:
          json_terms = {}  # –ò–∑–º–µ–Ω—è–µ–º –Ω–∞ —Å–ª–æ–≤–∞—Ä—å –≤–º–µ—Å—Ç–æ —Å–ø–∏—Å–∫–∞
          
          for term in terms_data:  # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–µ—Ä–º–∏–Ω—ã
              if isinstance(term, dict) and term.get('—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å', 0) >= 80:  # –ï—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω - —Å–ª–æ–≤–∞—Ä—å –∏ –µ–≥–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å >= 80
                  term_name = term.get('—Ç–µ—Ä–º–∏–Ω', '')  # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞
                  if term_name:  # –ï—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–æ–µ
                      json_terms[term_name] = {  # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Ä–º–∏–Ω –≤ —Å–ª–æ–≤–∞—Ä—å
                          'term': term_name,  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞
                          'definition': term.get('–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ', ''),  # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞
                          'translation': term.get('–ø–µ—Ä–µ–≤–æ–¥', ''),  # –ü–µ—Ä–µ–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞
                          'relevance': term.get('—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å', 0),  # –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ç–µ—Ä–º–∏–Ω–∞
                          'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')  # –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
                      }
          
          return json_terms  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å —Ç–µ—Ä–º–∏–Ω–∞–º–∏
          
      except Exception as e:  # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
          print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è JSON: {str(e)}")  # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
          return None  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º None

    def save_terms(self, ai_response, filename):  # –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–æ–≤
        """–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–æ–≤"""
        # –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ—Ä–º–∏–Ω–æ–≤
        terms_data = self.parse_ai_terms(ai_response)  # –ü–∞—Ä—Å–∏–º —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ –ò–ò
        
        if not terms_data:  # –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ—Ä–º–∏–Ω–∞—Ö
            print("–í –æ—Ç–≤–µ—Ç–µ –ò–ò –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è")  # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            return False  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º False

        # –£–¥–∞–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
        base_filename = os.path.splitext(filename)[0]  # –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
        
        # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å—Ç—Ä–æ–∫–∏
        output_filename = f"terms_{timestamp}_{base_filename}"  # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ CSV –∏ Excel
        csv_saved = self.save_to_csv(terms_data, output_filename)  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ CSV
        excel_saved = self.save_to_excel(terms_data, output_filename)  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Excel
        
        # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        json_terms = self.prepare_terms_for_json(terms_data)  # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Ä–º–∏–Ω—ã –¥–ª—è JSON
        
        added_count = 0  # –°—á–µ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
        updated_count = 0  # –°—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
        
        if json_terms:  # –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Ä–º–∏–Ω—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ JSON
            db_saved = self.json_manager.add_terms(json_terms)  # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Ä–º–∏–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            if db_saved:  # –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ
                # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                for term_data in json_terms.values():  # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–µ—Ä–º–∏–Ω—ã
                    if self.json_manager.term_exists(term_data['term']):  # –ï—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ
                        updated_count += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
                    else:  # –ï—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω –Ω–æ–≤—ã–π
                        added_count += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
                
                # –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                print(f"\n–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤:")  # –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                print(f"‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤: {added_count}")  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
                print(f"üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤: {updated_count}")  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
                print(f"üìö –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–µ—Ä–º–∏–Ω–æ–≤: {added_count + updated_count}")  # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Ä–º–∏–Ω–æ–≤
                print("–¢–µ—Ä–º–∏–Ω—ã —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å—é –±–æ–ª—å—à–µ 80% —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö")  # –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
            else:  # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
                print("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö")  # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        else:  # –ï—Å–ª–∏ –Ω–µ—Ç —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            print("–ù–µ—Ç —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö")  # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            db_saved = False  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ False

        return all([csv_saved, excel_saved, db_saved])  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º True, –µ—Å–ª–∏ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
